window.addEventListener("load",()=>{let l=[],e=document.getElementById("search-mask"),t=document.querySelector("#local-search .search-dialog"),n=(window.openSearch=()=>{utils.animateIn(e,"to_show 0.5s"),t.style.display="block",setTimeout(()=>{document.querySelector("#local-search .search-box-input").focus()},100),document.addEventListener("keydown",function e(t){"Escape"===t.code&&(a(),document.removeEventListener("keydown",e))}),n(),window.addEventListener("resize",n)},()=>{window.innerWidth<768&&t.style.setProperty("--search-height",window.innerHeight+"px")}),a=()=>{utils.animateOut(t,"search_close .5s"),utils.animateOut(e,"to_hide 0.5s"),window.removeEventListener("resize",n)};var c;0<(c=document.querySelectorAll("#local-search .tag-list")).length&&c.forEach(e=>e.addEventListener("click",e=>a())),document.addEventListener("keydown",function(e){e.ctrlKey&&"k"===e.key&&(e.preventDefault(),openSearch())}),e.addEventListener("click",a),utils.addEventListenerPjax(document.querySelector("#local-search .search-close-button"),"click",a);let r=()=>{utils.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",openSearch),GLOBAL_CONFIG.right_menu&&document.getElementById("menu-search").addEventListener("click",function(){rm.hideRightMenu(),openSearch();var e=document.getElementsByClassName("search-box-input")[0],t=document.createEvent("HTMLEvents");t.initEvent("input",!0,!0),e.value=selectTextNow,e.dispatchEvent(t)})},i=(r(),""),s=0,o=10,d=[];function m(){let c=document.getElementById("search-results");document.getElementById("search-input").addEventListener("keydown",function(n){if(13===n.keyCode)if(n.preventDefault(),(c.innerHTML="")!==(i=this.value.trim())){u(d=(e=>{let t=new RegExp(e.split("").join(".*"),"i");return l.filter(e=>t.test(e.title)||t.test(e.content))})(i),s);{n=d.length;let e=Math.ceil(n/o),t=document.getElementById("search-pagination");t.innerHTML="";var a=document.createElement("ul");a.className="pagination-list";for(let t=0;t<e;t++){let e=document.createElement("li");e.className="pagination-item",e.textContent=t+1,t===s&&e.classList.add("select"),e.addEventListener("click",function(){s=t,u(d,t),document.querySelectorAll(".pagination-item").forEach(function(e){e.classList.remove("select")}),e.classList.add("select")}),a.appendChild(e)}t.appendChild(a)}}else n=document.getElementById("search-results"),e=document.getElementById("search-pagination"),t=document.getElementById("search-tips"),n.innerHTML="",e.innerHTML="",t.innerHTML="";var e,t})}function u(e,t){let a=document.getElementById("search-results");a.innerHTML="";var n=document.getElementById("search-tips"),t=(n.innerHTML="",t*o),c=t+o;if(!e.length){let e=document.createElement("span");return e.className="search-result-empty",e.textContent=GLOBAL_CONFIG.lang.search.empty.replace(/\$\{query}/,i),a.appendChild(e)}e.slice(t,c).forEach(function(e){var t=document.createElement("li"),n=(t.className="search-result-item",document.createElement("a"));n.className="search-result-title",n.href=e.link,n.innerHTML=((e,t)=>(t=new RegExp(`(${t.split(" ").join("|")})`,"gi"),e.replace(t,"<em>$1</em>")))(e.title,i),t.appendChild(n),a.appendChild(t)});t=document.createElement("span");t.className="search-result-count",t.innerHTML=GLOBAL_CONFIG.lang.search.count.replace(/\$\{count}/,e.length),n.appendChild(t)}fetch(GLOBAL_CONFIG.localsearch.path).then(e=>e.text()).then(e=>{var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("entry");for(let e=0;e<t.length;e++){var n=t[e],a=n.getElementsByTagName("title")[0].textContent,c=n.getElementsByTagName("url")[0].textContent,n=n.getElementsByTagName("content")[0].textContent;l.push({title:a,link:c,content:n})}}).catch(e=>console.error("Error loading search data:",e)),m(),window.addEventListener("DOMContentLoaded",e=>{m()}),window.addEventListener("pjax:complete",()=>{r()})});
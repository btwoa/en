document.addEventListener("DOMContentLoaded",()=>{if(navigator.serviceWorker?.controller){let t=e=>{let o=e.endsWith("js")?"script":"link",t="link"==o?"href":"src";for(var r of document.getElementsByTagName(o)){var a=r[t];if(e.length>a?e.endsWith(a):a.endsWith(e)){let t=document.createElement(o),e=r.text||r.textContent||r.innerHTML||"";return Array.from(r.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(e)),r.parentNode.replaceChildren(t,r),!0}}},r="updated",a=()=>{caches.match("https://id.v3/").then(e=>{e?e.json().then(e=>{utils&&utils.snackbarShow(`已刷新缓存，更新为${e.global+"."+e.local}版本最新内容`,!1,2e3)}):console.info("未找到缓存")}).catch(e=>console.error("缓存匹配出错",e))},e;sessionStorage.getItem(r)?(a(),sessionStorage.removeItem(r)):(e="update",navigator.serviceWorker.controller.postMessage("update")),navigator.serviceWorker.addEventListener("message",e=>{var o=e.data,e=(sessionStorage.setItem(r,o.type),o.list?.filter(e=>/\.(js|css)$/.test(e)));if(e)window.Pjax?.isSupported?.()&&e.forEach(t),location.reload();else{let e=o.new,t=o.old;!t||e.global===t.global&&e.local===t.local||a(),sessionStorage.removeItem(r)}})}});